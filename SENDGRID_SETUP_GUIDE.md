# SendGrid設定ガイド

**対象**: Care-passのメール機能を有効化するための設定手順

---

## 📧 SendGridとは

SendGridは、メール送信サービスのクラウドプラットフォームです。Care-passでは、保護者へのメール送信やバッジ獲得通知に使用します。

### 無料プランの内容
- **月12,000通まで無料**
- 保護者数400人以下なら追加費用なし
- クレジットカード登録不要

---

## 🚀 SendGridアカウント作成手順

### ステップ1: アカウント作成

1. [SendGrid公式サイト](https://sendgrid.com/)にアクセス
2. 「Start for Free」または「無料で始める」をクリック
3. 以下の情報を入力：
   - メールアドレス
   - パスワード
   - 名前
4. 「Create Account」をクリック

### ステップ2: メール認証

1. 登録したメールアドレスに認証メールが届く
2. メール内の「Verify Email Address」をクリック
3. SendGridにログイン

### ステップ3: 送信者情報の設定

1. ダッシュボードで「Settings」→「Sender Authentication」を選択
2. 「Single Sender Verification」を選択
3. 以下の情報を入力：
   - **From Name**: 事業所名（例: 〇〇放課後等デイサービス）
   - **From Email Address**: 送信元メールアドレス（例: info@your-facility.com）
   - **Reply To**: 返信先メールアドレス
   - **Company Address**: 事業所住所
   - **Nickname**: 識別用の名前（例: Care-pass）
4. 「Create」をクリック
5. 送信元メールアドレスに認証メールが届く
6. メール内の「Verify Single Sender」をクリック

### ステップ4: APIキーの作成

1. ダッシュボードで「Settings」→「API Keys」を選択
2. 「Create API Key」をクリック
3. 以下の情報を入力：
   - **API Key Name**: Care-pass（識別用）
   - **API Key Permissions**: 「Full Access」を選択
4. 「Create & View」をクリック
5. **APIキーをコピーして安全に保存**（後で使用）

**⚠️ 重要**: APIキーは一度しか表示されません。必ずコピーして安全な場所に保存してください。

---

## 🔧 Care-passへの設定

### Render環境変数の設定

1. Renderダッシュボードにログイン
2. Care-passのWebサービスを選択
3. 「Environment」タブを選択
4. 「Add Environment Variable」をクリック
5. 以下の環境変数を追加：

| Key | Value |
|:---|:---|
| `SENDGRID_API_KEY` | （ステップ4でコピーしたAPIキー） |
| `FROM_EMAIL` | （ステップ3で設定した送信元メールアドレス） |

6. 「Save Changes」をクリック
7. Renderが自動的に再デプロイを開始

---

## ✅ 動作確認

### テストメール送信

1. Care-passにログイン
2. ダッシュボードの「メール送信」セクションに移動
3. テスト用の保護者を選択
4. 件名と本文を入力
5. 「送信」をクリック
6. 保護者のメールアドレスに届くか確認

### 確認ポイント
- ✅ メールが正常に送信される
- ✅ 送信元が正しい（事業所名）
- ✅ 既読管理が動作する
- ✅ バッジ獲得通知が届く

---

## 🛠️ トラブルシューティング

### エラー1: 「Unauthorized」
**原因**: APIキーが正しく設定されていない  
**解決策**: 
1. Renderの環境変数を確認
2. APIキーが正しくコピーされているか確認
3. 再デプロイ

### エラー2: 「Sender not verified」
**原因**: 送信者情報が認証されていない  
**解決策**:
1. SendGridダッシュボードで「Sender Authentication」を確認
2. 送信元メールアドレスの認証メールを確認
3. 認証リンクをクリック

### エラー3: メールが届かない
**原因**: スパムフィルターに引っかかっている可能性  
**解決策**:
1. 迷惑メールフォルダを確認
2. SendGridダッシュボードで「Activity」を確認
3. 送信ステータスを確認（Delivered, Bounced, Spam Report等）

---

## 📊 送信状況の確認

### SendGridダッシュボード

1. SendGridにログイン
2. 「Activity」タブを選択
3. 以下の情報を確認：
   - **Delivered**: 配信成功
   - **Opened**: 開封された
   - **Clicked**: リンクがクリックされた
   - **Bounced**: 配信失敗
   - **Spam Report**: スパム報告

### Care-passダッシュボード

1. Care-passにログイン
2. 「メール送信」→「履歴」を選択
3. 以下の情報を確認：
   - 送信日時
   - 件名
   - 送信先数
   - 既読率

---

## 💡 ベストプラクティス

### 1. 送信頻度の管理
- 一斉送信は1日1回程度に抑える
- 重要な連絡以外は週1回程度にまとめる

### 2. 件名の工夫
- 簡潔で分かりやすい件名を使用
- 例: 「【〇〇放デイ】明日の遠足について」

### 3. 本文の構成
- 挨拶
- 本題
- 締めの言葉
- 署名（事業所名、連絡先）

### 4. 既読管理の活用
- 未読の保護者には個別に連絡
- 重要な連絡は電話でフォロー

---

## 🔒 セキュリティ

### APIキーの管理
- ✅ 環境変数に保存（コードに直接書かない）
- ✅ GitHubにアップロードしない（.gitignoreに含める）
- ✅ 定期的に更新（3ヶ月に1回程度）

### 個人情報保護
- ✅ 保護者のメールアドレスは暗号化して保存
- ✅ 一斉送信時はBCCを使用（他の保護者のアドレスが見えないようにする）
- ✅ 不要になったメールアドレスは削除

---

## 📞 サポート

### SendGridサポート
- [SendGridヘルプセンター](https://docs.sendgrid.com/)
- [SendGridコミュニティ](https://community.sendgrid.com/)

### Care-passサポート
- [Manusヘルプセンター](https://help.manus.im)

---

## ✅ チェックリスト

デプロイ前に以下を確認してください：

- [ ] SendGridアカウント作成完了
- [ ] 送信者情報の認証完了
- [ ] APIキーの作成完了
- [ ] Render環境変数の設定完了
- [ ] テストメール送信成功
- [ ] 既読管理の動作確認完了
- [ ] バッジ獲得通知の動作確認完了

---

**これでSendGridの設定は完了です！** 🎉

メール機能を活用して、保護者とのコミュニケーションを円滑にしましょう。
